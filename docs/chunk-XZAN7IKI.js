import{A as x,B as S,C as n,Db as _,F as k,ab as A,d as E,g as p,h as c,i as v,j as b,k as j,q as u,qb as T,rb as D,sb as H,u as m,w as d,z as f}from"./chunk-44XE7UFD.js";import{a as M}from"./chunk-YAHOFSNQ.js";var w=class extends Error{constructor(){super(...arguments),this.isAppError=!0}};var I=class extends w{constructor(){super("Unauthorized")}};var J={"cannot update published preset":"cannot update shared preset."},K=r=>J[r?.error?.message]||r?.error?.message||r?.statusText||r?.error;var $=new S("JWT_OPTIONS"),g=(()=>{class r{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let i=0,l,h,C=0;h=e.charAt(C++);~h&&(l=i%4?l*64+h:h,i++%4)?o+=String.fromCharCode(255&l>>(-2*i&6)):0)h=t.indexOf(h);return o}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let o=this.urlBase64Decode(t[1]);if(!o)throw new Error("Cannot decode the token.");return JSON.parse(o)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let o=new Date(0);return o.setUTCSeconds(t.exp),o}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(o=>this._isTokenExpired(o,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let o=this.getTokenExpirationDate(e);return t=t||0,o===null?!1:!(o.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return r.\u0275fac=function(e){return new(e||r)(n($))},r.\u0275prov=f({token:r,factory:r.\u0275fac}),r})(),R=r=>r instanceof Promise?j(()=>r):p(r),G=(()=>{class r{constructor(e,t,o){this.jwtHelper=t,this.document=o,this.standardPorts=["80","443"],this.tokenGetter=e.tokenGetter,this.headerName=e.headerName||"Authorization",this.authScheme=e.authScheme||e.authScheme===""?e.authScheme:"Bearer ",this.allowedDomains=e.allowedDomains||[],this.disallowedRoutes=e.disallowedRoutes||[],this.throwNoTokenError=e.throwNoTokenError||!1,this.skipWhenExpired=e.skipWhenExpired}isAllowedDomain(e){let t=new URL(e.url,this.document.location.origin);if(t.host===this.document.location.host)return!0;let o=`${t.hostname}${t.port&&!this.standardPorts.includes(t.port)?":"+t.port:""}`;return this.allowedDomains.findIndex(i=>typeof i=="string"?i===o:i instanceof RegExp?i.test(o):!1)>-1}isDisallowedRoute(e){let t=new URL(e.url,this.document.location.origin);return this.disallowedRoutes.findIndex(o=>{if(typeof o=="string"){let i=new URL(o,this.document.location.origin);return i.hostname===t.hostname&&i.pathname===t.pathname}return o instanceof RegExp?o.test(e.url):!1})>-1}handleInterception(e,t,o){let i=this.jwtHelper.getAuthScheme(this.authScheme,t);if(!e&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let l=p(!1);return this.skipWhenExpired&&(l=e?R(this.jwtHelper.isTokenExpired(e)):p(!0)),e?l.pipe(v(h=>h&&this.skipWhenExpired?t.clone():t.clone({setHeaders:{[this.headerName]:`${i}${e}`}})),b(h=>o.handle(h))):o.handle(t)}intercept(e,t){if(!this.isAllowedDomain(e)||this.isDisallowedRoute(e))return t.handle(e);let o=this.tokenGetter(e);return R(o).pipe(b(i=>this.handleInterception(i,e,t)))}}return r.\u0275fac=function(e){return new(e||r)(n($),n(g),n(A))},r.\u0275prov=f({token:r,factory:r.\u0275fac}),r})(),he=(()=>{class r{constructor(e){if(e)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(e){return{ngModule:r,providers:[{provide:D,useClass:G,multi:!0},e.jwtOptionsProvider||{provide:$,useValue:e.config},g]}}}return r.\u0275fac=function(e){return new(e||r)(n(r,12))},r.\u0275mod=k({type:r}),r.\u0275inj=x({}),r})();var a=_.roBackendUrl,z="refreshToken",P=class{constructor(){this.API={base:a,login:`${a}/login`,logout:`${a}/me/logout`,refreshToken:`${a}/refresh_token`,getMyProfile:`${a}/me`,getMyEntirePreset:`${a}/me/ro_entire_presets`,getMyPreset:`${a}/me/ro_presets`,getMyPresets:`${a}/me/ro_presets`,createMyPreset:`${a}/me/ro_presets`,bulkCreateMyPresets:`${a}/me/bulk_ro_presets`,likePresetTags:`${a}/preset_tags`,sharedPresets:`${a}/ro_presets`}}getRefreshToken(){return localStorage.getItem(z)}isUnauthorizedErr(s){return s?.message==="Unauthorized"||s?.status===401}handleUnauthErr(){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),c(()=>new I)}storeToken(s){localStorage.setItem("accessToken",s.accessToken),localStorage.setItem("refreshToken",s.refreshToken)}refreshToken(){let s=this.getRefreshToken();return s?this.http.post(`${this.API.refreshToken}`,{refreshToken:s}).pipe(d(e=>this.storeToken(e))):this.handleUnauthErr()}getAuthHeaders(){return{headers:{authorization:`bearer ${this.jwtHelper.tokenGetter()}`}}}get(s,e=!0){let t;return e?t=(this.jwtHelper.isTokenExpired()?this.refreshToken():p(null)).pipe(m(()=>this.http.get(s,this.getAuthHeaders()))):t=this.http.get(s),t.pipe(u(o=>this.isUnauthorizedErr(o)?this.handleUnauthErr():(console.error({err:o}),c(()=>o))))}post(s,e,t=!0){let o;return t?o=(this.jwtHelper.isTokenExpired()?this.refreshToken():p(null)).pipe(m(()=>this.http.post(s,e,this.getAuthHeaders()))):o=this.http.post(s,e),o.pipe(u(i=>this.isUnauthorizedErr(i)?this.handleUnauthErr():(console.error({err:i}),c(()=>i))))}delete(s,e=!0){let t;return e?t=(this.jwtHelper.isTokenExpired()?this.refreshToken():p(null)).pipe(m(()=>this.http.delete(s,this.getAuthHeaders()))):t=this.http.delete(s),t.pipe(u(o=>this.isUnauthorizedErr(o)?this.handleUnauthErr():(console.error({err:o}),c(()=>o))))}};var N=(()=>{class r extends P{constructor(e,t){super(),this.http=e,this.jwtHelper=t,this.profileEvent=new E(1),this.profileEventObs$=this.profileEvent.asObservable(),this.loggedInSubject=new E(1),this.loggedInEvent$=this.loggedInSubject.asObservable(),this.isLoggedIn=!1,this.getMyProfile().subscribe(),this.loggedInEvent$.subscribe(o=>this.isLoggedIn=o)}login(e){return this.profile=void 0,this.post(`${this.API.login}`,{authorizationCode:e},!1).pipe(d(t=>this.storeToken(t)),m(()=>this.getMyProfile()))}logout(){return this.post(`${this.API.logout}`,{}).subscribe({next:()=>{console.log("logout")},error:e=>{console.error({err:e})},complete:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),this.storeProfile({}),this.loggedInSubject.next(!1)}})}getMyProfile(){return this.get(this.API.getMyProfile).pipe(d(t=>this.storeProfile(t)),d(t=>{t?.id&&this.loggedInSubject.next(!0)}),u(()=>(this.loggedInSubject.next(!1),p(null))))}updateMyProfile(e){return this.post(this.API.getMyProfile,e).pipe(d(t=>this.storeProfile(t)),u(t=>(this.loggedInSubject.next(!1),c(()=>t))))}storeProfile(e){this.profile=M({},e),this.profileEvent.next(this.profile)}getProfile(){return this.profile}static{this.\u0275fac=function(t){return new(t||r)(n(T),n(g))}}static{this.\u0275prov=f({token:r,factory:r.\u0275fac})}}return r})();var O=(()=>{class r extends P{constructor(e,t){super(),this.http=e,this.jwtHelper=t}getPreset(e){return this.get(`${this.API.getMyPreset}/${e}`)}getMyPresets(){return this.get(`${this.API.getMyPreset}`)}getEntirePresets(){return this.get(`${this.API.getMyEntirePreset}`)}createPreset(e){return this.post(`${this.API.createMyPreset}`,e)}bulkCreatePresets(e){return this.post(`${this.API.bulkCreateMyPresets}`,e)}updatePreset(e,t){return this.post(`${this.API.getMyPreset}/${e}`,t)}deletePreset(e){return this.delete(`${this.API.getMyPreset}/${e}`)}sharePreset(e,t){return this.post(`${this.API.getMyPreset}/${e}/publish`,t)}unsharePreset(e){return this.delete(`${this.API.getMyPreset}/${e}/publish`)}addPresetTags(e,t){return this.post(`${this.API.getMyPreset}/${e}/tags`,t)}removePresetTag(e){let{presetId:t,tagId:o}=e;return this.delete(`${this.API.getMyPreset}/${t}/tags/${o}`)}likePresetTags(e){return this.post(`${this.API.likePresetTags}/${e}/like`,{})}unlikePresetTag(e){return this.delete(`${this.API.likePresetTags}/${e}/like`)}getPublishPresets(e){let{classId:t,tagName:o,skip:i,take:l}=e;return this.get(`${this.API.sharedPresets}/class_by_tags/${t}/${o}?skip=${i||0}&take=${l||1}`)}static{this.\u0275fac=function(t){return new(t||r)(n(T),n(g))}}static{this.\u0275prov=f({token:r,factory:r.\u0275fac})}}return r})();var Ie=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=k({type:r})}static{this.\u0275inj=x({providers:[N,O],imports:[H]})}}return r})();export{I as a,K as b,he as c,N as d,O as e,Ie as f};
