import{b as fe,c as Se,d as _e,e as Ce}from"./chunk-P476JSJO.js";import{E as he,F as ge,G as ue,o as se,z as pe}from"./chunk-HNAONX6N.js";import{A as $,Ba as J,Cb as K,E as q,Ea as D,F as B,Fa as z,J as P,K as R,Mc as me,N as ee,Na as k,Nc as ce,O,Oa as E,Oc as de,Vb as le,Z as a,_ as V,ba as S,c as L,da as p,ea as r,eb as ne,fa as l,fb as ie,ga as y,jb as ae,ka as G,l as Z,ma as A,mb as oe,na as h,ob as re,r as N,ra as H,w as W,wa as m,xa as C,ya as T,za as te}from"./chunk-44XE7UFD.js";import{a as F,b as U}from"./chunk-YAHOFSNQ.js";var o=function(e){return e.Weapon="Weapon",e.WeaponCard="WeaponCard",e.LeftWeapon="LeftWeapon",e.LeftWeaponCard="LeftWeaponCard",e.Shield="Shield",e.ShieldCard="ShieldCard",e.HeadUpper="HeadUpper",e.HeadUpperCard="HeadUpperCard",e.HeadMiddle="HeadMiddle",e.HeadMiddleCard="HeadMiddleCard",e.HeadLower="HeadLower",e.Armor="Armor",e.ArmorCard="ArmorCard",e.Garment="Garment",e.GarmentCard="GarmentCard",e.Boot="Boot",e.BootCard="BootCard",e.AccRight="AccRight",e.AccRightCard="AccRightCard",e.AccLeft="AccLeft",e.AccLeftCard="AccLeftCard",e.CostumeEnchantUpper="CostumeEnchantUpper",e.CostumeEnchantMiddle="CostumeEnchantMiddle",e.CostumeEnchantLower="CostumeEnchantLower",e.CostumeEnchantGarment="CostumeEnchantGarment",e.ShadowWeapon="ShadowWeapon",e.ShadowShield="ShadowShield",e.ShadowArmor="ShadowArmor",e.ShadowBoot="ShadowBoot",e.ShadowEarring="ShadowEarring",e.ShadowPendant="ShadowPendant",e}(o||{});function Ee(e,c){if(e&1&&(r(0,"div",16),y(1,"img",17),r(2,"div",18),m(3),l()()),e&2){let t=c.$implicit;a(1),H("src","assets/demo/images/jobs/icon_jobs_",t.icon,".png",O),a(2),C(t.label)}}function je(e,c){if(e&1&&(r(0,"div",19)(1,"div",18),m(2),l(),r(3,"div",18),m(4),k(5,"number"),k(6,"number"),l()()),e&2){let t=c.$implicit;a(2),C(t.label),a(2),te("( ",E(5,3,t.total)," accounts, ",E(6,5,t.totalPresets)," presets )")}}function Te(e,c){if(e&1&&(r(0,"div",23),y(1,"img",24),r(2,"div",25),m(3),l()()),e&2){let t=h().$implicit;a(1),H("src","assets/demo/images/items/",t.id,".png",O),a(2),T(" ",t.name," ")}}function Le(e,c){if(e&1&&(r(0,"div",20),S(1,Te,4,2,"div",21),y(2,"div",22),l()),e&2){let t=c.$implicit,i=h();a(1),p("ngIf",i.selectedItemId),a(1),p("innerHTML",t.desc,ee)}}function Ne(e,c){if(e&1){let t=G();r(0,"div")(1,"p-checkbox",32),A("ngModelChange",function(n){P(t);let s=h().$implicit,d=h();return R(d.isShowEnchant[s]=n)})("ngModelChange",function(){P(t);let n=h().$implicit,s=h();return R(s.onToggleShowEnchantClick(n))}),l()()}if(e&2){let t=h().$implicit,i=h();a(1),p("ngModel",i.isShowEnchant[t])("binary",!0)}}function Pe(e,c){if(e&1&&(r(0,"div",40),y(1,"img",24),r(2,"div",25),m(3),l()()),e&2){let t=h(2).$implicit;a(1),H("src","assets/demo/images/items/",t.ItemId,".png",O),a(2),T(" ",t.ItemName," ")}}var xe=function(){return{height:"8px"}},Ie=function(e){return{width:e}};function Re(e,c){if(e&1&&(r(0,"div",35),S(1,Pe,4,2,"div",36),r(2,"div",37)(3,"div",38),y(4,"div",39),l(),r(5,"span"),m(6),l()()()),e&2){let t=h().$implicit;a(1),p("ngIf",t.ItemId),a(2),p("ngStyle",D(10,xe)),a(1),J("bg-",t.ColorStyle," h-full"),p("ngStyle",z(11,Ie,t.Percentage+"%")),a(1),J("text-",t.ColorStyle," ml-2"),a(1),T("",t.Percentage," %")}}function Oe(e,c){if(e&1&&(r(0,"div"),y(1,"img",24),r(2,"div"),m(3),l()()),e&2){let t=c.$implicit,i=h(2).$implicit;J("flex gap-1 ",i.EnchantInfos.length===3?"item_enchant":"",""),a(1),H("src","assets/demo/images/items/",t.id,".png",O),a(2),C(t.name)}}function Ae(e,c){if(e&1&&(r(0,"div",41)(1,"div",42),S(2,Oe,4,5,"div",43),l(),r(3,"div",37)(4,"div",38),y(5,"div",44),l(),r(6,"span",45),m(7),l()()()),e&2){let t=h().$implicit;a(2),p("ngForOf",t.EnchantInfos),a(2),p("ngStyle",D(4,xe)),a(1),p("ngStyle",z(5,Ie,t.Percentage+"%")),a(2),T("",t.Percentage," %")}}function He(e,c){if(e&1&&(S(0,Re,7,13,"div",33),S(1,Ae,8,7,"div",34)),e&2){let t=c.$implicit;p("ngIf",!t.IsEnchant),a(1),p("ngIf",t.IsEnchant)}}function $e(e,c){if(e&1){let t=G();r(0,"div",26)(1,"div",27)(2,"div",28),m(3),l(),S(4,Ne,2,2,"div",29),l(),r(5,"p-listbox",30),A("ngModelChange",function(n){P(t);let s=h();return R(s.selectedItemId=n)})("onChange",function(){P(t);let n=h();return R(n.onItemChange())}),S(6,He,2,2,"ng-template",31),l()()}if(e&2){let t=c.$implicit,i=h();p("hidden",!i.rankingMap[t].length),a(3),T(" ",t," "),a(1),p("ngIf",i.isItemHasEnchant[t]),a(1),p("options",i.rankingMap[t])("ngModel",i.selectedItemId)}}var ve=()=>Object.values(o).reduce((e,c)=>(e[c]=[],e),{}),be=e=>Object.values(o).reduce((c,t)=>(c[t]=e,c),{}),we=(()=>{class e{constructor(t,i){this.summaryService=t,this.roService=i,this.jobChangeSource=new L,this.jobChangeEvent$=this.jobChangeSource.asObservable(),this.skillChangeSource=new L,this.skillChangeEvent$=this.skillChangeSource.asObservable(),this.itemChangeSource=new L,this.itemChangeEvent$=this.itemChangeSource.asObservable(),this.toggleShowEnchantSource=new L,this.toggleShowEnchantEvent$=this.toggleShowEnchantSource.asObservable(),this.subscribtions=[],this.isLoading=!1,this.allItemPositions=Object.values(o),this.allClasses=me(),this.allClasseMap=new Map(this.allClasses.map(n=>[n.value,n.label])),this.selectedJobId=this.allClasses[0].value,this.selectedJobName=this.allClasses[0].label,this.selectedSkillName="",this.itemMap={},this.jobSkillSummary={},this.presetSummary={},this.jobSummary={},this.totalSummary={},this.totalPresets=0,this.totalCurrentJobPresets=0,this.isShowEnchant=be(!1),this.isItemHasEnchant=be(!1),this.skillRankingList=[],this.rankingMap=ve()}ngOnInit(){this.loadData(),this.subscribeEvent()}ngOnDestroy(){for(let t of this.subscribtions)t.unsubscribe()}loadData(){Z([this.summaryService.getJobSkillSummary(),this.summaryService.getJobPresetSummary(),this.summaryService.getJobSummary(),this.summaryService.getTotalSummary(),this.roService.getItems()]).subscribe(([t,i,n,s,d])=>{this.jobSkillSummary=t,this.presetSummary=i,this.jobSummary=n,this.totalSummary=s,this.itemMap=d,this.totalPresets=Object.values(i).reduce((u,g)=>u+Object.values(g).reduce((v,f)=>v+f,0),0),this.setSkillRanking(),this.setItemRanking()})}subscribeEvent(){let t=this.jobChangeEvent$.pipe(W(()=>this.isLoading=!0),N(50)).subscribe(()=>{this.setSkillRanking(),this.setItemRanking(),this.selectedJobName=this.allClasseMap.get(this.selectedJobId)||"",this.isLoading=!1}),i=this.skillChangeEvent$.pipe(W(()=>this.isLoading=!0),N(50)).subscribe(()=>{this.setItemRanking(),this.isLoading=!1}),n=this.itemChangeEvent$.pipe(N(50)).subscribe(()=>{let d=`${this.selectedItemId}`.split("-").map(Number).filter(Boolean);this.displaySelectedItems=[...new Set(d)].map(u=>{let g=this.itemMap[u]||{};return{id:u,desc:le(g.description),name:g.name}})}),s=this.toggleShowEnchantEvent$.pipe(N(50)).subscribe(d=>{this.setItemRanking(d)});this.subscribtions.push(t,i,n,s)}get itemRankingList(){return!this.selectedJobId||!this.selectedSkillName?ve():this.totalSummary[this.selectedJobId][this.selectedSkillName]}get totalAccounts(){return this.jobSummary[this.selectedJobId]||0}setSkillRanking(){let t=this.jobSkillSummary[this.selectedJobId]||{},i=[];for(let[n,s]of Object.entries(t))i.push({value:n,label:n,total:Number(s),totalPresets:this.presetSummary[this.selectedJobId]?.[n]||0});this.skillRankingList=i.sort((n,s)=>s.total-n.total),this.selectedSkillName=i[0]?.value,this.totalCurrentJobPresets=Object.values(this.presetSummary[this.selectedJobId]).reduce((n,s)=>n+s,0)}setItemRanking(t){for(let i of this.allItemPositions){if(t&&i!==t)continue;let n=[],s=!1;for(let d of this.itemRankingList[i]){let u=Math.ceil(d.UsingRate*100/this.jobSkillSummary[this.selectedJobId][this.selectedSkillName]);n.push(U(F({},d),{Percentage:u,ItemName:this.itemMap[d.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(i),IsEnchant:!1,EnchantInfos:[]}));let g=Object.entries(d.Enchants);if(s||(g.length===0||g.length===1&&g[0][0]==="0-0-0"?s=!1:s=!0),this.isShowEnchant[i]!==!0)continue;let v=g.sort(([f,x],[_,j])=>j-x).filter(([f,x],_)=>_<=4&&x>=.5);for(let[f,x]of v){let _=Math.floor(x*100/(d.TotalEnchant||1));if(_<=0)continue;let[j,I,b]=f.split("-").map(Number);if(j||I||b){let w=[j,I,b].filter(Number);n.push({ItemId:f,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:_,ColorStyle:this.getItemBarColorStyle(i),EnchantInfos:w.map(M=>({id:M,name:this.itemMap[M]?.name}))})}}}this.isItemHasEnchant[i]=s,this.rankingMap[i]=n}}setItemRanking2(t){let i=this.jobSkillSummary[t]||{},n={};for(let[s]of Object.entries(i)){n[s]||(n[s]={});let d=this.totalSummary[t][s];for(let u of this.allItemPositions){let g=[],v=!1;for(let f of d[u]){let x=Math.ceil(f.UsingRate*100/this.jobSkillSummary[t][s]);g.push(U(F({},f),{Percentage:x,ItemName:this.itemMap[f.ItemId]?.name,ColorStyle:this.getItemBarColorStyle(u),IsEnchant:!1,EnchantInfos:[]}));let _=Object.entries(f.Enchants);if(v||(_.length===0||_.length===1&&_[0][0]==="0-0-0"?v=!1:v=!0),this.isShowEnchant[u]===!1)continue;let j=_.sort(([I,b],[w,M])=>M-b).filter(([I,b],w)=>w<=4&&b>=.5);for(let[I,b]of j){let w=Math.floor(b*100/(f.TotalEnchant||1));if(w<=0)continue;let[M,Q,X]=I.split("-").map(Number);if(M||Q||X){let ke=[M,Q,X].filter(Number);g.push({ItemId:I,Enchants:{},UsingRate:0,ItemName:"",TotalAccount:0,TotalEnchant:0,TotalPreset:0,IsEnchant:!0,Percentage:w,ColorStyle:this.getItemBarColorStyle(u),EnchantInfos:ke.map(Y=>({id:Y,name:this.itemMap[Y]?.name}))})}}}n[s][u]=g}}return n}getItemBarColorStyle(t){switch(t){case o.Weapon:case o.WeaponCard:return"orange-500";case o.LeftWeapon:case o.LeftWeaponCard:return"orange-500";case o.Shield:case o.ShieldCard:return"pink-400";case o.HeadUpper:case o.HeadUpperCard:case o.HeadMiddle:case o.HeadMiddleCard:case o.HeadLower:return"blue-400";case o.Armor:case o.ArmorCard:case o.Garment:case o.GarmentCard:case o.Boot:case o.BootCard:return"red-500";case o.AccLeft:case o.AccLeftCard:case o.AccRight:case o.AccRightCard:return"teal-400";case o.CostumeEnchantUpper:case o.CostumeEnchantMiddle:case o.CostumeEnchantLower:case o.CostumeEnchantGarment:return"yellow-500";case o.ShadowWeapon:case o.ShadowShield:case o.ShadowArmor:case o.ShadowBoot:case o.ShadowEarring:case o.ShadowPendant:return"green-500";default:return"orange-500"}}onJobChange(){this.jobChangeSource.next(1)}onSkillChange(){this.skillChangeSource.next(1)}onItemChange(){this.itemChangeSource.next(1)}onToggleShowEnchantClick(t){this.toggleShowEnchantSource.next(t)}static{this.\u0275fac=function(i){return new(i||e)(V(de),V(ce))}}static{this.\u0275cmp=q({type:e,selectors:[["app-preset-summary"]],decls:39,vars:21,consts:[[1,"grid","grid-nogutter",2,"min-width","1500px"],[1,"col-12","mb-2"],[1,"grid","grid-nogutter","column_list"],[3,"options","ngModel","disabled","ngModelChange","onChange"],["pTemplate","item","class","py-0"],[1,"col-12","grid","grid-nogutter"],[1,"col-3"],[1,"card","text-lg","m-0","p-2"],[1,"text-primary","text-lg"],[1,"mr-2","font-medium"],[1,"text-primary"],[1,"card","px-1","py-3","sticky","desc-sticky"],[1,"text-lg","font-bold","mb-3"],["class","mb-4",4,"ngFor","ngForOf"],[1,"col-9","grid","grid-nogutter"],["class","col-6 p-1",3,"hidden",4,"ngFor","ngForOf"],[1,"flex","gap-2","py-0"],["alt","",1,"job_img",3,"src"],[1,"text_ellips"],[1,"w-full","flex","justify-content-between"],[1,"mb-4"],["class","flex gap-1 mb-2",4,"ngIf"],[1,"px-2","py-2",2,"color","#000","background-color","#fff",3,"innerHTML"],[1,"flex","gap-1","mb-2"],["alt","",1,"item_img",3,"src"],[1,"text_ellips","font-medium"],[1,"col-6","p-1",3,"hidden"],[1,"card","m-0","p-2","flex","justify-content-around"],[1,"font-bold","text-lg"],[4,"ngIf"],["optionValue","ItemId",3,"options","ngModel","ngModelChange","onChange"],["pTemplate","item","styleClass","py-0 xxx"],["label","Show enchant",3,"ngModel","binary","ngModelChange"],["class","flex w-full justify-content-between",4,"ngIf"],["class","flex pl-4 w-full justify-content-between",4,"ngIf"],[1,"flex","w-full","justify-content-between"],["class","flex gap-1",4,"ngIf"],[1,"mt-2","md:mt-0","flex","align-items-center",2,"min-width","130px"],[1,"surface-300","border-round","overflow-hidden","w-10rem","lg:w-6rem",3,"ngStyle"],[3,"ngStyle"],[1,"flex","gap-1"],[1,"flex","pl-4","w-full","justify-content-between"],[1,"flex","gap-2","w-full"],[3,"class",4,"ngFor","ngForOf"],[1,"bg-yellow-300","h-full",3,"ngStyle"],[1,"text-yellow-300","ml-2"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-listbox",3),A("ngModelChange",function(d){return n.selectedJobId=d})("onChange",function(){return n.onJobChange()}),S(4,Ee,4,2,"ng-template",4),l()()(),r(5,"div",5)(6,"div",6)(7,"div",7)(8,"div"),m(9,"Information date: 31-05-2568"),l(),r(10,"div"),m(11," Total "),r(12,"span",8),m(13),k(14,"number"),l(),m(15," accounts, "),r(16,"span",8),m(17),k(18,"number"),l(),m(19," presets "),l(),r(20,"div")(21,"span",9),m(22),l(),r(23,"span",10),m(24),k(25,"number"),l(),m(26," accounts, "),r(27,"span",10),m(28),k(29,"number"),l(),m(30," presets "),l()(),r(31,"p-listbox",3),A("ngModelChange",function(d){return n.selectedSkillName=d})("onChange",function(){return n.onSkillChange()}),S(32,je,7,7,"ng-template",4),l(),r(33,"div",11)(34,"div",12),m(35,"Item Description"),l(),S(36,Le,3,2,"div",13),l()(),r(37,"div",14),S(38,$e,7,5,"div",15),l()()()),i&2&&(a(3),p("options",n.allClasses)("ngModel",n.selectedJobId)("disabled",n.isLoading),a(10),C(E(14,13,n.jobSummary[0])),a(4),C(E(18,15,n.totalPresets)),a(5),C(n.selectedJobName),a(2),C(E(25,17,n.totalAccounts)),a(4),C(E(29,19,n.totalCurrentJobPresets)),a(3),p("options",n.skillRankingList)("ngModel",n.selectedSkillName)("disabled",n.isLoading),a(5),p("ngForOf",n.displaySelectedItems),a(2),p("ngForOf",n.allItemPositions))},dependencies:[_e,se,ne,ie,ae,he,ge,fe,oe],styles:["[_nghost-%COMP%]     .column_list p-listbox .p-listbox-list{min-width:1480px;columns:10;padding:0}[_nghost-%COMP%]     .column_list .p-listbox-item{padding:.5rem}.job_img[_ngcontent-%COMP%]{height:fit-content}.desc-sticky[_ngcontent-%COMP%]{top:40px;height:100vh;overflow:auto}.item_img[_ngcontent-%COMP%]{height:fit-content}.item_enchant[_ngcontent-%COMP%]{width:33.33%}"]})}}return e})();var Me=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=B({type:e})}static{this.\u0275inj=$({imports:[K.forChild([{path:"",component:we}]),K]})}}return e})();var gt=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=B({type:e})}static{this.\u0275inj=$({imports:[Me,Ce,pe,re,ue,Se]})}}return e})();export{gt as PresetSummaryModule};
